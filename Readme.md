# Library Management System Rest API
Library management system is a rest api based on Spring BOOT.
It manages the record of books present in a library along with the ones that have been checked out and those returned back so as to track the movement of books in a library.

# INFO
All the DOCS are generated by JavaDoc. and is present in the code.
Just navigate to doc folder and run index.html, you will get all the info of all the classes and their methods and what they do.


# Installation
This app uses PostgreSQL as main engine database.
Just install the engine first.
Here is the Link to download -> [PostgreSQL](https://www.postgresql.org/download/).

Import this project in eclipse or in any other IDE.
This project uses MAVEN, so all the dependencies will be downloaded for you automatically.
Edit your database settings in application.properties file.

Run your Spring Boot application.

All tables will be created automatically.

# How this app works?
The whole application is based on authentication and authorization.
Spring security has been implemented to achieve that.

	PLEASE NOTE: There is already an api present for registering the users, but it can only be accessed by the LIBRARIAN, so we have to create one user manually(with role as ROLE_LIBRARIAN).

First There must be a user account present who should have admin rights, here admin role is defined as (ROLE_LIBRARIAN), and user role as (ROLE_USER).

To create a user please run the following sql script.

```sql
	insert into users (email,first_name, last_name,password,user_name) values ('tramboos123@gmail.com','Shahrukh','Tramboo','$2a$10$x4c8.bc3ch4EY/LIA.WSVe/x4N3EpCtKGFWs0jE/K0hIKBg.dsgzK','Shah9999');
```
After running the above script we will create a user with username as Shah9999, and password is in bcrypt form, whose value is admin . 
The username and password will be used later on to generate and validate JWT token.

To create roles please run the following sql script.

```sql
	INSERT INTO `role` (name) VALUES('ROLE_USER'),('ROLE_LIBRARIAN');
```

To assign ROLE_LIBRARIAN to newly created user, run the following script
It is presumed that the newly created user has id = 1;

```sql
	INSERT INTO `users_roles` (user_id,role_id)VALUES(1, 1),(1, 2);
```

After running the above script, the new user with username ( Shah9999 ) will have both the roles of USER (ROLE_USER) and LIBRARIAN (ROLE_LIBRARIAN).

Moving on...

	PLEASE NOTE: All the DOCS are generated by JavaDoc. and is present in the code.
	Just navigate to doc folder and run index.html, you will get all the info of all the classes and their methods and what they do.

Also use POSTMAN for running this application.

# How Authentication works?
Url for authenticating and receiving a token which can then be saved as a cookie or in local storage to manage session of a user, can be achieved by this url 
1.	http://localhost:8080/authenticate
2. Method = POST
3. Content-Type = application/json
4. In the body pass the JSON like this
	
	```
		{
		    "username":"Shah9999",
		    "password":"admin"
		}
	```
5.	The app will authenticate the username and password and on successfull authentication, provides you with a JWT token.
KEEP it...

# 1. Registration of user:
Url for creating user is http://localhost:8080/security/users
1. http://localhost:8080/security/users
2.	Method = POST
3.	Headers: 
		Content-type -> application/json
		Authorization -> Bearer **token**
		
		Please NOTE: **token** should be replaced by the JWT token received previously.
		I told you to save it.
		Now paste that here and also there should be a space in between Bearer and **token**
4.	Body :

	```
		{
		    "userName": "test1234",
		    "password": "admin",
		    "firstName": "test",
		    "lastName": "last",
		    "email": "test123@gmail.com",
		    "formRole": "ROLE_USER,ROLE_LIBRARIAN"
		}
	```
In the body above we are giving user and Librarian roles to new user which is about to get created.
in order to give only one role, replace
	
	```
		"formRole": "ROLE_USER,ROLE_LIBRARIAN"
	``` 	
	
with

	```
		"formRole": "ROLE_USER"
	```
	
	Please Note: Prefix ( ROLE_ )  is mandatory!!!
	
Moving on...

To get books,
We have two controllers

LibrarianBookController and UserBookController
What are they?
And why two?

1.	LibrarianBookController has request mapping of (/admin) and UserBookController has request mapping of (/user)
	This is done to secure api's.

# LibrarianBookController
	# Add Books:
	1.	http://localhost:8080/admin/books/
	2.	Method = POST
	3.	Headers: 
		Content-type -> application/json
		Authorization -> Bearer **token**
	4.	Body:
			{
			    "name": "Death Note",
			    "isbn": "24354ADFW2",
			    "author": "Mandal"
			}


	# To get books:
		By books i mean all books, which are not currently available (some other user has taken it).
	1.	http://localhost:8080/admin/books
	2.	Method = GET
	3.	Headers: 
			Content-type -> application/json
			Authorization -> Bearer **token**
			
			
	# Search books by name: Let us assume book name is death note
	1.	http://localhost:8080/admin/books/death note
	2.	Method = GET
	3.	Headers: 
			Content-type -> application/json
			Authorization -> Bearer **token**
			
			
	# Search books by author: Let us assume author's name is Mandal
	1.	http://localhost:8080/admin/books/author/mandal
	2.	Method = GET
	3.	Headers: 
			Content-type -> application/json
			Authorization -> Bearer **token**
			
	There is even api for updating books and params.
	Please check docs for that, that are present in docs folder, just run index.html

	# What are params?
	If the user checks out a book, the books gets assigned to the user, and book status turns to pending, the return date is automatically calculated from the default params set in parameter_mst table.
	The id of this parameter is hardcoded in the source as 1.
	
	
	# Get all pending books of the user.
	1.	http://localhost:8080/admin/books/pending/{username}
	2.	Method = GET
	3.	Headers: 
			Content-type -> application/json
			Authorization -> Bearer **token**
			
	# If the user is kind enough to return books, librarian has to update the book in order to make it available again for everybody
	1.	http://localhost:8080/admin/books/return/{bookId}
	2.	Method = PUT
	3.	Headers: 
			Content-type -> application/json
			Authorization -> Bearer **token**
			
	The above url will automatically change the status of book from P to R(returned).
	
	One more thing...
	
	When returning, also the logs are stored in other table called user_book_history, which maintains all the records of interaction between user and books.
			

# UserBookController
	Add Books, Get books, search books by name and author are same as above but only available books are returned.
	Urls are
	1.	For get books: http://localhost:8080/user/books/
	2.	For searching with name: http://localhost:8080/user/books/death note
	3.	For searching with author: http://localhost:8080/user/books/author/mandal
	
	# Assigning books to user
	1.	http://localhost:8080/user/books/add/{bookId}
	2.	Method = PUT
	3.	Headers: 
			Content-type -> application/json
			Authorization -> Bearer **token**
			
	Now check the bookStatus, it will be pending, also if logged in as LIBRARIAN,
		check url http://localhost:8080/admin/books/pending/{username} (as discussed above)
		
		
# If you are here, you have reached the end, THANK YOU For Reading!
		
	


			
	
	
		


	

	


















